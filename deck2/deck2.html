<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Interactive Visualization</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dave Armstrong" />
    <meta name="date" content="2020-05-27" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="libs/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap/js/bootstrap.min.js"></script>
    <script src="libs/d3/d3.min.js"></script>
    <link href="libs/d3scatter/d3scatter.css" rel="stylesheet" />
    <script src="libs/d3scatter/d3scatter.js"></script>
    <script src="libs/d3scatter-binding/d3scatter.js"></script>
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Interactive Visualization
## Interactivity without Shiny 2
### Dave Armstrong
### May 27, 2020

---









# linking plots

One of the coolest things about these interactive plots is that they allow linking across plots.  

- plotly has a built-in feature that does this. 
  - The 'highlight' argument allows linking the plots. 

- the R package `{crosstalk}` does this for several compatible plots in the htmlwidgets universe.  

---

# within plotly


```r
p1 &lt;- ohio %&gt;% 
      highlight_key(~county) %&gt;%
      plot_ly(x = ~lt25k, y=~repvote, text=~county,  
              textposition="top", hoverinfo="x+y") %&gt;% 
      add_markers()

p2 &lt;- ohio %&gt;% 
      highlight_key(~county) %&gt;%
      plot_ly(x = ~over60_pop, y=~repvote, text=~county,  
              textposition="top", hoverinfo="x+y") %&gt;% 
      add_markers() 
```


```r
subplot(p1, p2) %&gt;% 
  highlight(on = "plotly_selected", off="plotly_doubleclick", persistent=FALSE) %&gt;% 
  layout(height=400, width=800, shareY=TRUE, titleX=TRUE, 
         xaxis=list(title="White Proportion"), 
         xaxis2 = list(title="Over 60 Proportion"), 
         yaxis = list(title="Republican Vote Share")) 
```

[See the plot](https://davidaarmstrong.github.io/deck2/sharing2.html#plotly-with-subplot)

---

# plotly highlight redux

- Easy to implement
- First plot talks to second, but not other way around. 

---

# Crosstalk - scatterplots

[Crosstalk](https://rstudio.github.io/crosstalk/) is a package that provides linkages across plots.  Here's an example: 


```r
remotes::install_github("rstudio/crosstalk")
remotes::install_github("jcheng5/d3scatter")
remotes::install_github("rstudio/leaflet")
```



```r
library(crosstalk)
s &lt;- SharedData$new(ohio)

p1 &lt;- s %&gt;% 
  plot_ly(x=~lt25k, y=~repvote, text=~county) %&gt;% 
  add_markers() %&gt;% 
  layout(xaxis=list(title="Households Making &lt; $25k"), 
         yaxis = list(title="Republican Share of Vote")) 
p2 &lt;- s %&gt;% 
  plot_ly(x=~white_pop, y=~repvote, text=~county) %&gt;% 
  add_markers() %&gt;% 
  layout(xaxis=list(title="White Share of Population"), 
         yaxis = list(title="Republican Share of Vote"))
```

---

# plot


```r
bscols(p1, p2)
```

<div class="container-fluid crosstalk-bscols">
<div class="fluid-row">
<div class="col-xs-6">
<div id="htmlwidget-6df63a988e2c297ea5b5" style="width:100%;height:400px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-6df63a988e2c297ea5b5">{"x":{"visdat":{"3610479d42a7":["function () ","plotlyVisDat"]},"cur_data":"3610479d42a7","attrs":{"3610479d42a7":{"x":{},"y":{},"text":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Households Making < $25k"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Republican Share of Vote"},"dragmode":"zoom","hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[0.246800846788208,0.286174653939113,0.185350243231924,0.297468897468897,0.214081666946732,0.364324846922333,0.23445580776586,0.419329594365462,0.365462662337662,0.239035087719298,0.216621133339209,0.205767924411783,0.25287922645809,0.247955370199859,0.289338193416107,0.364779297054235,0.33841259209645,0.358744576456754,0.371649383682254,0.27424461976064,0.340311004784689,0.219195849546044,0.211797595750629,0.315476006789076,0.275088214537756,0.233594259621657,0.22841798015178,0.215833379989922,0.36212412028151,0.274943769680612,0.289083927591882,0.213829330504836,0.10834764685675,0.257403189066059,0.20778002426203,0.256321666416304,0.297413194540879,0.303491380414457,0.221805421103582,0.383828432858442,0.267982625097966,0.328202215845688,0.278414839797639,0.308492528844335,0.209007683504986,0.301594331266608,0.302571383498975,0.252306723350653,0.260678812991286,0.231696188942566,0.244989881846074,0.441227509361586,0.340286964485601,0.22804372408594,0.275325093027307,0.188235294117647,0.147725580148351,0.267190575630743,0.213879905602657,0.2952488145984,0.237561750176429,0.322513495395689,0.285924942859249,0.297266152745768,0.216266428129086,0.30717695335399,0.178856113802298,0.307675628794449,0.177012761934772,0.380438201069294,0.242429119449711,0.248128434808949,0.225840553874217,0.258584598940008,0.245795601552393,0.158299150730834,0.302832907179674,0.128773997124574,0.193269711778966,0.240288902263994,0.210463991460689,0.251238924086308,0.223306762106176,0.14039112508623,0.398752318327432,0.294412658049022,0.21926726991834,0.218862964180085],"y":[0.715642755681818,0.696352298942464,0.580694429382207,0.744829513694802,0.645920129454528,0.71850170261067,0.552329759009507,0.692338791186578,0.741880015284677,0.75642965204236,0.712338209389599,0.693143897259581,0.769998943252668,0.774461269656377,0.532649557791347,0.690673892142295,0.745482388973966,0.728246892413202,0.788256713700501,0.746380785259925,0.724183750949127,0.795154185022026,0.723406058038551,0.683817049944569,0.694636924537257,0.733294629898403,0.682226591403987,0.604307956824912,0.751252578838786,0.601455589154836,0.692389178617992,0.738640211956413,0.584802925639984,0.81741687770607,0.62645999767691,0.752937631816812,0.405819944137972,0.599511505334876,0.781245258206464,0.755142314990512,0.59079827542724,0.483040082164383,0.688334270955864,0.787950317540606,0.760583105226303,0.681465707742376,0.711958791591257,0.550287074639406,0.772899910634495,0.499510342610659,0.685272045028143,0.409536863367479,0.685795011691348,0.621680320060964,0.503848734370235,0.824189416026151,0.632416938655954,0.44599932200604,0.829843928435478,0.718146368005804,0.745809155383623,0.706118489278426,0.642995035852179,0.718780658724597,0.708775137111517,0.749076222394088,0.716500588965649,0.788388214904679,0.836604596544204,0.763820670916501,0.362071752805029,0.692885814330857,0.543299451651732,0.666921588915381,0.732588820028226,0.701014953126211,0.316251832674658,0.697143831988004,0.640421995808946,0.700717896124826,0.651780149331569,0.454868808926353,0.81417246967109,0.630057936361964,0.788915662650602,0.728814704689823,0.748071721927276,0.838008616562949],"text":["Hancock","Allen","Lake","Fayette","Butler","Morgan","Portage","Scioto","Vinton","Paulding","Henry","Fulton","Brown","Logan","Trumbull","Pike","Monroe","Lawrence","Adams","Crawford","Guernsey","Van Wert","Pickaway","Muskingum","Richland","Champaign","Wayne","Ottawa","Harrison","Clark","Hocking","Miami","Delaware","Darke","Greene","Ashland","Lucas","Ashtabula","Preble","Jackson","Stark","Mahoning","Tuscarawas","Highland","Morrow","Marion","Perry","Erie","Clinton","Lorain","Defiance","Athens","Jefferson","Sandusky","Montgomery","Auglaize","Geauga","Hamilton","Holmes","Columbiana","Carroll","Belmont","Ross","Washington","Madison","Hardin","Clermont","Noble","Putnam","Meigs","Franklin","Huron","Wood","Seneca","Williams","Union","Cuyahoga","Warren","Fairfield","Knox","Licking","Summit","Shelby","Medina","Gallia","Coshocton","Wyandot","Mercer"],"type":"scatter","mode":"markers","key":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88"],"set":"SharedData6f365e66","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0,"ctGroups":["SharedData6f365e66"]},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="col-xs-6">
<div id="htmlwidget-057ff5e26a5fbd57406b" style="width:100%;height:400px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-057ff5e26a5fbd57406b">{"x":{"visdat":{"3610258306ac":["function () ","plotlyVisDat"]},"cur_data":"3610258306ac","attrs":{"3610258306ac":{"x":{},"y":{},"text":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"White Share of Population"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Republican Share of Vote"},"dragmode":"zoom","hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[0.938377452917161,0.831828409456182,0.917857483710317,0.941254447777855,0.845527200832684,0.925842235004108,0.909014466601607,0.944676962199677,0.971839561610473,0.964125799573561,0.970206010485121,0.968445453685306,0.971469198660612,0.946933286300101,0.886772694548073,0.958242776214059,0.976577229876722,0.955116426686266,0.971216274707834,0.966955475330927,0.956537337911947,0.968424030267671,0.937007196226285,0.923024262325517,0.871138489995789,0.946895804304072,0.952012210370192,0.970075302313032,0.958283906682483,0.869056729947617,0.971111502554166,0.935361789459811,0.868273559020827,0.973890848157746,0.860501800648829,0.967494650665178,0.742548831237105,0.929697516744792,0.969753884430568,0.968441205533597,0.881019662301453,0.803833793469836,0.965066828675577,0.958683636025826,0.972402597402597,0.903840259899473,0.97427358254933,0.867586946324466,0.946952944812992,0.862008459870549,0.953570024891917,0.908490078701875,0.916341022093147,0.933536284630691,0.731295002545409,0.973408435944459,0.969063393987089,0.676870123572887,0.986079467784562,0.953177811328106,0.971345223588494,0.934493741204355,0.906786600980099,0.959654226581332,0.901177583140072,0.964675984752224,0.951524826491974,0.955482792253031,0.980373001776199,0.972517960702848,0.671798061512631,0.960908655818406,0.93116086184734,0.939880812215842,0.966144984240843,0.90739171781793,0.636013625360471,0.881907026226133,0.874215249515348,0.966522870114553,0.91454693375965,0.783609328348569,0.939971620704547,0.956806180433836,0.942960072050435,0.966720358186137,0.974105311146569,0.967821480016602],"y":[0.715642755681818,0.696352298942464,0.580694429382207,0.744829513694802,0.645920129454528,0.71850170261067,0.552329759009507,0.692338791186578,0.741880015284677,0.75642965204236,0.712338209389599,0.693143897259581,0.769998943252668,0.774461269656377,0.532649557791347,0.690673892142295,0.745482388973966,0.728246892413202,0.788256713700501,0.746380785259925,0.724183750949127,0.795154185022026,0.723406058038551,0.683817049944569,0.694636924537257,0.733294629898403,0.682226591403987,0.604307956824912,0.751252578838786,0.601455589154836,0.692389178617992,0.738640211956413,0.584802925639984,0.81741687770607,0.62645999767691,0.752937631816812,0.405819944137972,0.599511505334876,0.781245258206464,0.755142314990512,0.59079827542724,0.483040082164383,0.688334270955864,0.787950317540606,0.760583105226303,0.681465707742376,0.711958791591257,0.550287074639406,0.772899910634495,0.499510342610659,0.685272045028143,0.409536863367479,0.685795011691348,0.621680320060964,0.503848734370235,0.824189416026151,0.632416938655954,0.44599932200604,0.829843928435478,0.718146368005804,0.745809155383623,0.706118489278426,0.642995035852179,0.718780658724597,0.708775137111517,0.749076222394088,0.716500588965649,0.788388214904679,0.836604596544204,0.763820670916501,0.362071752805029,0.692885814330857,0.543299451651732,0.666921588915381,0.732588820028226,0.701014953126211,0.316251832674658,0.697143831988004,0.640421995808946,0.700717896124826,0.651780149331569,0.454868808926353,0.81417246967109,0.630057936361964,0.788915662650602,0.728814704689823,0.748071721927276,0.838008616562949],"text":["Hancock","Allen","Lake","Fayette","Butler","Morgan","Portage","Scioto","Vinton","Paulding","Henry","Fulton","Brown","Logan","Trumbull","Pike","Monroe","Lawrence","Adams","Crawford","Guernsey","Van Wert","Pickaway","Muskingum","Richland","Champaign","Wayne","Ottawa","Harrison","Clark","Hocking","Miami","Delaware","Darke","Greene","Ashland","Lucas","Ashtabula","Preble","Jackson","Stark","Mahoning","Tuscarawas","Highland","Morrow","Marion","Perry","Erie","Clinton","Lorain","Defiance","Athens","Jefferson","Sandusky","Montgomery","Auglaize","Geauga","Hamilton","Holmes","Columbiana","Carroll","Belmont","Ross","Washington","Madison","Hardin","Clermont","Noble","Putnam","Meigs","Franklin","Huron","Wood","Seneca","Williams","Union","Cuyahoga","Warren","Fairfield","Knox","Licking","Summit","Shelby","Medina","Gallia","Coshocton","Wyandot","Mercer"],"type":"scatter","mode":"markers","key":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88"],"set":"SharedData6f365e66","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0,"ctGroups":["SharedData6f365e66"]},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>


---

# crosstalk - d3scatter


```r
library(d3scatter)

bscols(
  d3scatter(s, ~lt25k, ~asinh(cases), ~urban_rural, width="100%", height=400), 
  d3scatter(s, ~BAplus, ~asinh(cases), ~urban_rural, width="100%", height=400)
)
```

<div class="container-fluid crosstalk-bscols">
<div class="fluid-row">
<div class="col-xs-6">
<div id="htmlwidget-bec5a68aa61997541f43" style="width:100%;height:400px;" class="d3scatter html-widget"></div>
<script type="application/json" data-for="htmlwidget-bec5a68aa61997541f43">{"x":{"data":{"x":[0.246800846788208,0.286174653939113,0.185350243231924,0.297468897468897,0.214081666946732,0.364324846922333,0.23445580776586,0.419329594365462,0.365462662337662,0.239035087719298,0.216621133339209,0.205767924411783,0.25287922645809,0.247955370199859,0.289338193416107,0.364779297054235,0.33841259209645,0.358744576456754,0.371649383682254,0.27424461976064,0.340311004784689,0.219195849546044,0.211797595750629,0.315476006789076,0.275088214537756,0.233594259621657,0.22841798015178,0.215833379989922,0.36212412028151,0.274943769680612,0.289083927591882,0.213829330504836,0.10834764685675,0.257403189066059,0.20778002426203,0.256321666416304,0.297413194540879,0.303491380414457,0.221805421103582,0.383828432858442,0.267982625097966,0.328202215845688,0.278414839797639,0.308492528844335,0.209007683504986,0.301594331266608,0.302571383498975,0.252306723350653,0.260678812991286,0.231696188942566,0.244989881846074,0.441227509361586,0.340286964485601,0.22804372408594,0.275325093027307,0.188235294117647,0.147725580148351,0.267190575630743,0.213879905602657,0.2952488145984,0.237561750176429,0.322513495395689,0.285924942859249,0.297266152745768,0.216266428129086,0.30717695335399,0.178856113802298,0.307675628794449,0.177012761934772,0.380438201069294,0.242429119449711,0.248128434808949,0.225840553874217,0.258584598940008,0.245795601552393,0.158299150730834,0.302832907179674,0.128773997124574,0.193269711778966,0.240288902263994,0.210463991460689,0.251238924086308,0.223306762106176,0.14039112508623,0.398752318327432,0.294412658049022,0.21926726991834,0.218862964180085],"y":[4.54340793644413,5.86363924626486,6.19848284760558,4.18988423142563,7.2427984344583,2.31243834127275,6.40688270910277,3.33347758688399,3.52722445619997,3.17978543769988,3.25957255626292,4.24869926123636,3.82911365162088,4.15912713462618,6.90575428032198,2.49177985264491,4.86759361680199,3.98932680581955,2.77647228072372,5.3278997328544,4.06074014324457,2.31243834127275,8.30943080274696,4.43095849208054,5.82895426801699,3.91242276564126,6.04501092931631,4.88285930974907,2.99822295029797,5.87493862117652,4.83634488915927,6.51323231220997,6.32793997248945,5.6489866362643,5.14752827715488,3.52722445619997,8.32166486627669,6.26530482705402,4.09462222433053,3.09310219505083,7.15773609080403,7.84541618989812,6.37332270165412,3.46671103788472,5.33756119280531,8.53973719408767,3.46671103788472,5.56835907135839,4.45448247706051,7.12929819098168,4.09462222433053,3.25957255626292,4.82034659568175,4.83634488915927,7.01031268186136,4.70056300017719,6.17794841835641,8.40200683196989,3.40230664548059,6.83947758454787,3.95161333608207,6.58479330013643,4.78756117999381,5.44675595022109,5.34713020568319,4.18988423142563,5.81114995696388,2.49177985264491,5.12399940835939,2.0947125472611,9.1870717555132,4.52190670356432,6.24997896907635,3.46671103788472,4.54340793644413,4.3821828480655,8.90027636722293,6.42649107576938,6.09582963503384,3.82911365162088,5.98645831819655,7.73280772245181,4.24869926123636,6.19440955600993,2.64412076105863,3.78470576309943,4.18988423142563,5.78690679069606],"key":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88"],"color":["UP > 20k, adj","Metro < 250k","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Rural, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP 2500-20k, non-adj","Rural, adj","Metro 250k-1M","UP 2500-20k, adj","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro < 250k","UP 2500-20k, adj","UP > 20k, adj","UP > 20k, adj","UP 2500-20k, adj","Metro < 250k","Metro >1M","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","Metro 250k-1M","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro >1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","UP > 20k, adj","Metro < 250k","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","Metro >1M","Metro >1M","UP 2500-20k, non-adj","UP > 20k, adj","Metro 250k-1M","Metro < 250k","UP > 20k, adj","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, non-adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","Metro >1M","Metro >1M","Metro >1M","UP > 20k, adj","Metro >1M","Metro 250k-1M","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","UP 2500-20k, non-adj"]},"color_spec":{"type":"ordinal","values":["Metro >1M","Metro 250k-1M","Metro < 250k","UP > 20k, adj","UP < 20k, non-adj","UP 2500-20k, adj","UP 2500-20k, non-adj","Rural, adj","Rural, non-adj"]},"color":["UP > 20k, adj","Metro < 250k","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Rural, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP 2500-20k, non-adj","Rural, adj","Metro 250k-1M","UP 2500-20k, adj","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro < 250k","UP 2500-20k, adj","UP > 20k, adj","UP > 20k, adj","UP 2500-20k, adj","Metro < 250k","Metro >1M","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","Metro 250k-1M","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro >1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","UP > 20k, adj","Metro < 250k","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","Metro >1M","Metro >1M","UP 2500-20k, non-adj","UP > 20k, adj","Metro 250k-1M","Metro < 250k","UP > 20k, adj","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, non-adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","Metro >1M","Metro >1M","Metro >1M","UP > 20k, adj","Metro >1M","Metro 250k-1M","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","UP 2500-20k, non-adj"],"x_label":"lt25k","y_label":"asinh(cases)","x_lim":null,"y_lim":null,"group":"SharedData6f365e66"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="col-xs-6">
<div id="htmlwidget-bd1c5666cf7ccb2957ae" style="width:100%;height:400px;" class="d3scatter html-widget"></div>
<script type="application/json" data-for="htmlwidget-bd1c5666cf7ccb2957ae">{"x":{"data":{"x":[0.239273423340868,0.157882408058093,0.23876254488537,0.137002218231752,0.243345466464256,0.0949770779350209,0.240244446519542,0.130842570343384,0.0741782980639352,0.0976230899830221,0.127088554720134,0.135106193110833,0.0924281095797175,0.135532079360989,0.15839307270557,0.130512225400766,0.0923769449065466,0.132289855072464,0.108929233049278,0.10997635623276,0.113825917625014,0.14605988764624,0.1330242510699,0.137634824157678,0.145063020324636,0.143429487179487,0.187585043270016,0.190658029321514,0.0834168108551134,0.160057450021649,0.107166438112652,0.194666317489416,0.468252895752896,0.106555511295738,0.334245349756564,0.170571484958696,0.218495300877757,0.129795303859405,0.110400337422235,0.113470765949884,0.196208519779444,0.195862910315215,0.13504394350809,0.102960655855082,0.142801200887613,0.123377928662363,0.0891471187616529,0.19636552826192,0.146525787965616,0.197124841624721,0.150817236255572,0.252338894340857,0.141085079639818,0.130828729281768,0.238642920443157,0.148508430609598,0.335667802912922,0.317090589463275,0.0906133630098874,0.118254408926258,0.119930157146421,0.13413708966394,0.121460506706408,0.158661426587909,0.157195701955258,0.147956881423916,0.23846908734053,0.095575959933222,0.166765768650231,0.0997870207967928,0.350882247516248,0.114307012132429,0.277580704805993,0.163152529642148,0.119310530568274,0.253488073040571,0.274466559694104,0.340670443744246,0.232459447232933,0.178944015290276,0.216794158553547,0.286918545876073,0.144274005804127,0.283956601827941,0.136772819668958,0.11439205955335,0.133559410460415,0.142753401620547],"y":[4.54340793644413,5.86363924626486,6.19848284760558,4.18988423142563,7.2427984344583,2.31243834127275,6.40688270910277,3.33347758688399,3.52722445619997,3.17978543769988,3.25957255626292,4.24869926123636,3.82911365162088,4.15912713462618,6.90575428032198,2.49177985264491,4.86759361680199,3.98932680581955,2.77647228072372,5.3278997328544,4.06074014324457,2.31243834127275,8.30943080274696,4.43095849208054,5.82895426801699,3.91242276564126,6.04501092931631,4.88285930974907,2.99822295029797,5.87493862117652,4.83634488915927,6.51323231220997,6.32793997248945,5.6489866362643,5.14752827715488,3.52722445619997,8.32166486627669,6.26530482705402,4.09462222433053,3.09310219505083,7.15773609080403,7.84541618989812,6.37332270165412,3.46671103788472,5.33756119280531,8.53973719408767,3.46671103788472,5.56835907135839,4.45448247706051,7.12929819098168,4.09462222433053,3.25957255626292,4.82034659568175,4.83634488915927,7.01031268186136,4.70056300017719,6.17794841835641,8.40200683196989,3.40230664548059,6.83947758454787,3.95161333608207,6.58479330013643,4.78756117999381,5.44675595022109,5.34713020568319,4.18988423142563,5.81114995696388,2.49177985264491,5.12399940835939,2.0947125472611,9.1870717555132,4.52190670356432,6.24997896907635,3.46671103788472,4.54340793644413,4.3821828480655,8.90027636722293,6.42649107576938,6.09582963503384,3.82911365162088,5.98645831819655,7.73280772245181,4.24869926123636,6.19440955600993,2.64412076105863,3.78470576309943,4.18988423142563,5.78690679069606],"key":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88"],"color":["UP > 20k, adj","Metro < 250k","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Rural, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP 2500-20k, non-adj","Rural, adj","Metro 250k-1M","UP 2500-20k, adj","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro < 250k","UP 2500-20k, adj","UP > 20k, adj","UP > 20k, adj","UP 2500-20k, adj","Metro < 250k","Metro >1M","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","Metro 250k-1M","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro >1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","UP > 20k, adj","Metro < 250k","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","Metro >1M","Metro >1M","UP 2500-20k, non-adj","UP > 20k, adj","Metro 250k-1M","Metro < 250k","UP > 20k, adj","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, non-adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","Metro >1M","Metro >1M","Metro >1M","UP > 20k, adj","Metro >1M","Metro 250k-1M","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","UP 2500-20k, non-adj"]},"color_spec":{"type":"ordinal","values":["Metro >1M","Metro 250k-1M","Metro < 250k","UP > 20k, adj","UP < 20k, non-adj","UP 2500-20k, adj","UP 2500-20k, non-adj","Rural, adj","Rural, non-adj"]},"color":["UP > 20k, adj","Metro < 250k","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Rural, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP 2500-20k, non-adj","Rural, adj","Metro 250k-1M","UP 2500-20k, adj","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro < 250k","UP 2500-20k, adj","UP > 20k, adj","UP > 20k, adj","UP 2500-20k, adj","Metro < 250k","Metro >1M","Metro 250k-1M","Metro >1M","UP 2500-20k, adj","Metro 250k-1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","Metro 250k-1M","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro >1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","UP > 20k, adj","Metro < 250k","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","Metro >1M","Metro >1M","UP 2500-20k, non-adj","UP > 20k, adj","Metro 250k-1M","Metro < 250k","UP > 20k, adj","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","Metro >1M","UP 2500-20k, non-adj","UP 2500-20k, adj","UP 2500-20k, adj","Metro >1M","UP > 20k, adj","Metro 250k-1M","UP > 20k, adj","UP 2500-20k, adj","Metro >1M","Metro >1M","Metro >1M","Metro >1M","UP > 20k, adj","Metro >1M","Metro 250k-1M","UP > 20k, adj","Metro >1M","UP 2500-20k, adj","UP 2500-20k, adj","UP 2500-20k, non-adj","UP 2500-20k, non-adj"],"x_label":"BAplus","y_label":"asinh(cases)","x_lim":null,"y_lim":null,"group":"SharedData6f365e66"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>



---

# crosstalk - map scatter data


```r
library(rio)
library(DT)
library(mapview)
shoot &lt;- import("stanford_mass_shooting.dta")

shoot &lt;- shoot %&gt;% select( latitude, longitude, date, city, numberofcivilianfatalities, 
                           numberofcivilianinjured, numberofenforcementfatalities, numberofenforcementinjured)
shoot$date &lt;- as.Date(shoot$date, format="%m/%d/%Y")
names(shoot) &lt;- c("lat", "long", "date", "city", "num_civ_fatal", "num_civ_injur", "num_pol_fatal", "num_pol_injur")

shoot2 &lt;- SharedData$new(shoot)
library(leaflet)
bscols(widths = c(6,6), 
  leaflet(shoot2, width="100%", height=400) %&gt;% addTiles() %&gt;% addMarkers(), 
  datatable(shoot2, extensions="Scroller", style="bootstrap", class="compact", width="100%", 
            colnames=c("Longitude", "Latitude", "Date", "City", "# Civilians Killed", 
                       "# Civilians Injured", "# Police Killed", "# Police Injured"),
            options = list(paging=FALSE, pageLength = 20, scrollY = "200px"), 
            fillContainer = TRUE) %&gt;%
    formatRound(columns=c("lat", "long"), digits=1)
)
```

[See the plot](https://davidaarmstrong.github.io/deck2/sharing2.html#crosstalk-with-leaflet-and-dt)

---

## selection and filtering


```r
bscols(widths = c(6,6), 
  list(
    leaflet(shoot2, width="100%", height=400) %&gt;% addTiles() %&gt;% addMarkers(), 
    filter_slider("yr", "Year", shoot2, ~year, sep="")
  ),
  datatable(shoot2, extensions="Scroller", style="bootstrap", class="compact", width="100%", 
            colnames=c("Longitude", "Latitude", "Date", "City", "# Civilians Killed", 
                       "# Civilians Injured", "# Police Killed", "# Police Injured"),
            options = list(paging=FALSE, pageLength = 20, scrollY = "200px"), 
            fillContainer = TRUE) %&gt;%
    formatRound(columns=c("lat", "long"), digits=1)
)
```

[See the plot](https://davidaarmstrong.github.io/deck2/sharing2.html#selection-and-filtering)


---

## You try it 

Using the `scad_africa.csv` file, investigate some of the methods we've discussed so far.  You can find the codebook [here](https://www.strausscenter.org/wp-content/uploads/SCAD_33_Codebook.pdf).  There are two other filters,

- `filter_checkbox()` 
- `filter_select()` 

Give those a try - using them to filter countries or certain types of events.  



<div class="countdown" id="timer_5ecda751" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Dahsboards

Dashboards have one key difference from full-blown Shiny apps. 

- They don't do analytics on the server-side.  All of the action takes place on the client side.  

- You can build shiny dashboards, but they must be hosted on a shiny server.  

- We're going to use the `flexdashboard` template for building a our dashboard. 


```r
install.packages("flexdashboard")
```


Go to File `\(\rightarrow\)` New `\(\rightarrow\)` RMarkdown and choose "From Template". 

- When the dialog box comes up, choose "Flex Dashboard"

---

# flexdashboard 

There is a ton of great advice about using flexdashboards [here](https://rmarkdown.rstudio.com/flexdashboard/using.html). 

- You can set the layout as either row or column oriented and can then identify where you want the columns or rows and how you want them distributed. 

- You can build multi-page dashboards with storyboards. 

- You can include any element and text you want in the dashboard.  

Let's look at the template we get when we start. 

---

# first dashboard

Let's make a static dashboard using the `diamonds` data in the `{ggplot2}` package.  Let's have the following three elements, we'll work through it in pieces: 

- Scatterplot of `price` (y) by `carat` (x), facet on `cut`, color by `color` where "Chart A" is:


<div class="countdown" id="timer_5ecda73d" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


--

- Bar plot of `clarity` where "Chart B" is. 

<div class="countdown" id="timer_5ecda756" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

--

- Heat Map of `color` and `clarity` where the color fill is proportional to average `price` just for diamonds that are between .75 and 1 carat where "Chart C" is.   

<div class="countdown" id="timer_5ecda6e6" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

--

My dashboard for this problem is [here](https://quantoid.net/files/iviz/diamonds-dashboard.html)

---

# COVID Dashboard

I want you to make a dashboard that has the following elements: 

1. A `plotly` map of the log of cases where "Chart A" is. 
2. A `d3scatter` plot of `cases` by `repvote`.
3. A `datatable` using the (`DT`) package 

Use the `crosstalk` package to make a `SharedData()` object so that these three elements will be linked. 

<div class="countdown" id="timer_5ecda504" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Your turn!

Give this a try with your own data - see what you can come up with.  

Feel free to take a break, stretch your legs, etc...  We'll reconvene in 15 minutes. 

<div class="countdown" id="timer_5ecda4b8" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# parameterized RMarkdown

You can build parameters into your RMarkdown document.  

- These aren't parameters that are changeable in the HTML, 

- but you can generate different HTML documents by changing the call to `rmarkdown::render()` 

- You add parameters as unquoted `key: value` pairs under the `parameters:` heading in the document's YAML header. For example 

For example: 


```r
---
title: "Ohio Covid Map"
output: 
  flexdashboard::flex_dashboard:
    theme: yeti
    orientation: columns
    vertical_layout: fill
params: 
  state: Ohio
---
---
title: `r paste0(params$state, " COVID-19 Dashboard")`
---
```

---

# include parameters

You can access the parameter(s) with `params$state`. 

- You could use the parameter to filter the data to different States. 

For example: 


```r
rmarkdown::render("covid_dashboard_param.Rmd", 
  params = list(state = "Ohio")
)
```

This will typeset a new document called `covid_dashboard_param.html` that has Ohio's data in it.  To automate for many plots, you could execute a loop (chaing the `output_file` argument each time: 


```r
states &lt;- c("Maine", "Michigan", "Wisconsin", "Maryland")
for(i in 1:length(states)){
rmarkdown::render("covid_dashboard_param.Rmd", 
  params = list(state = states[i]), 
  output_file = paste0(states[i], " COVID-19 Dashboard")
)
}
```

---

# Your turn! 

Try this out either with the dashboard you made with your own data or with the Diamonds dashboard that we made before. 

- if you're using the Diamonds dashboard, make `clarity` the parameter variable and replace the barpolot of `clarity` (which will no longer be interesting) with a scatterplot of `table` and `depth`.  

<div class="countdown" id="timer_5ecda795" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Animation

One of the last pieces we're going to talk about is animation in `plotly` plots.  

- This happens by using the `frame = ~variable` argument, where the `variable`. 
- The animation will move across the values of the `variable` specified in the `farme` argument. 

We'll use the `gapminder_unfiltered` data 


```r
library(gapminder)
gapminder %&gt;% 
  mutate(text = paste0(
    country, "\n Life Expectancy = ", lifeExp, 
    "\n GDP/Capita = ", round(gdpPercap), 
    "\n Population = ", round(pop/1000000), "M")) %&gt;% 
  plot_ly(x = ~gdpPercap,  y = ~lifeExp, size = ~pop, 
          color = ~continent, frame = ~year, text = ~text, 
          hoverinfo = "text", type = 'scatter',
          mode = 'markers') %&gt;% 
  layout(xaxis = list(type = "log"))
```

See the plot [here](https://quantoid.net/files/iviz/sharing-plot.html#plotly-with-animation)

---

# plot
&lt;center&gt;
<iframe src="p.6.html" height="600" width="750" scrolling="no" seamless="seamless" frameBorder="0"></iframe>
&lt;/center&gt;

---

# states 

Using the `states_covid.rda` file, make an animated scatterplot of COVID cases versus deaths.  

- you can either try to do it by day or aggregate to the week.  
  - both `date` and `week` are variables in the dataset. 
  - Hint: the `deaths` and `cases` variables are both cumulative, so if you use the week aggregation, you'll want to take the maximum in each week.  

<div class="countdown" id="timer_5ecda787" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Your turn!

Build some animation into your dashboard. 

- Either use the dashboard that you created above with your own data and add in an animated plot.  

- Alternatively, use the `states_covid.rda` data and create a dashboard that has two maps - most recent cases and most recent deaths as well as the animated plot of cases by deaths.  

<div class="countdown" id="timer_5ecda7f2" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
